# Canton 2.7.8 Simple Topology Configuration
# Single-node setup: 1 participant + 1 domain in same process
# Based on: https://docs.daml.com/canton/tutorials/getting_started.html

canton {
  participants {
    participant1 {
      # Storage (H2 for persistence across restarts)
      storage {
        type = h2
        config {
          url = "jdbc:h2:/canton-data/participant1"
          user = "participant1"
          password = "change-me"
        }
      }
      
      # Admin API (for management)
      admin-api {
        address = "0.0.0.0"
        port = 5012
      }
      
      # Ledger API (for gRPC queries)
      ledger-api {
        address = "0.0.0.0"
        port = 5011
      }
      
      # HTTP JSON API (for backend REST calls)
      http-ledger-api-experimental {
        server {
          address = "0.0.0.0"
          port = 7011
        }
      }
      
      # Auto-initialization (KEY FEATURE)
      init {
        auto-init = true
      }
    }
  }
  
  # Embedded domain (runs in same JVM process)
  domains {
    local {
      storage {
        type = h2
        config {
          url = "jdbc:h2:/canton-data/domain"
          user = "domain"
          password = "change-me"
        }
      }
      
      public-api {
        address = "0.0.0.0"
        port = 5018
      }
      
      admin-api {
        address = "0.0.0.0"
        port = 5019
      }
      
      # Auto-initialization
      init {
        auto-init = true
      }
    }
  }
  
  # Enable testing commands (useful for demo)
  features {
    enable-testing-commands = yes
  }
  
  # Logging (helps with debugging)
  monitoring.logging {
    api {
      message-payloads = true
    }
  }
}

